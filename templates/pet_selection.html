<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenCareer - Choose Your Companion</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="{{ url_for('static', filename='js/translations.js') }}"></script>
</head>
<body class="pet-selection-page">
    <!-- Back Button -->
    <button class="back-button" onclick="goBack()" title="Go back">
        ‚Üê
    </button>
    
    <!-- Music Controls -->
    <div class="music-controls">
        <button id="musicToggle" class="music-btn" title="Toggle Background Music">
            <span class="music-icon">üéµ</span>
        </button>
    </div>
    
    <div class="container">
        <header>
            <h1 class="title">Choose Your Travel Companion</h1>
            <p class="subtitle">This friendly companion will guide you through your career discovery journey</p>
        </header>
        
        <section class="selection-area">
            <div class="selection-box pet-selection">
                <form action="{{ url_for('set_pet') }}" method="post" id="petForm">
                    <div class="options-grid pet-grid">
                        {% for pet in pets %}
                        <div class="pet-option">
                            <div class="pet-animation-container" onclick="selectPet('{{ pet }}')">
                                <div class="pet-placeholder">
                                    <div class="pet-icon">
                                        {% if pet == 'panda' %}üêº
                                        {% elif pet == 'penguin' %}üêß
                                        {% elif pet == 'puppy' %}üê∂
                                        {% else %}üêæ
                                        {% endif %}
                                    </div>
                                    <div class="pet-name">{{ pet.title() }}</div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <input type="hidden" name="pet" id="petInput">
                </form>
            </div>
        </section>
    </div>
    
    <!-- Audio Elements -->
    <audio id="clickSound" src="https://zencareer.b-cdn.net/click.mp3" preload="auto"></audio>
    <audio id="ambientMusic" src="https://zencareer.b-cdn.net/ambient.mp3" preload="auto" loop>
        Your browser does not support the audio element.
    </audio>
    
    <script>
        const clickSound = document.getElementById('clickSound');
        const ambientMusic = document.getElementById('ambientMusic');
        const musicToggle = document.getElementById('musicToggle');
        const petForm = document.getElementById('petForm');
        const petInput = document.getElementById('petInput');
        let isMusicPlaying = false;
        
        // Initialize music continuity
        function initializeMusic() {
            ambientMusic.volume = 0.3;
            const musicState = JSON.parse(sessionStorage.getItem('zenCareerMusicState') || '{"isPlaying":false}');
            
            if (musicState.isPlaying) {
                ambientMusic.play().then(() => {
                    isMusicPlaying = true;
                    musicToggle.classList.remove('muted');
                }).catch(err => console.log('Music playback error:', err));
            } else {
                musicToggle.classList.add('muted');
                musicToggle.querySelector('.music-icon').textContent = 'üîá';
            }
        }
        
        // Toggle music
        function toggleMusic() {
            if (isMusicPlaying) {
                ambientMusic.pause();
                isMusicPlaying = false;
                musicToggle.classList.add('muted');
                musicToggle.querySelector('.music-icon').textContent = 'üîá';
            } else {
                ambientMusic.play().then(() => {
                    isMusicPlaying = true;
                    musicToggle.classList.remove('muted');
                    musicToggle.querySelector('.music-icon').textContent = 'üéµ';
                }).catch(err => console.log('Music playback error:', err));
            }
            
            // Save music state
            sessionStorage.setItem('zenCareerMusicState', JSON.stringify({
                isPlaying: isMusicPlaying,
                currentTime: ambientMusic.currentTime
            }));
        }
        
        function playClickSound() {
            clickSound.currentTime = 0;
            clickSound.play().catch(err => console.log('Audio playback error:', err));
        }
        
        function selectPet(pet) {
            playClickSound();
            petInput.value = pet;
            petForm.submit();
        }
        
        function goBack() {
            window.location.href = "{{ url_for('back_to_language') }}";
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeMusic();
            
            // Add music toggle event listener
            musicToggle.addEventListener('click', toggleMusic);
        });
    </script>
</body>
</html>