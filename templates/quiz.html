<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ZenCareer Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.9.6/lottie.min.js"></script>
</head>
<body>
  <div id="video-container">
    <video id="quizVideo" src="{{ url_for('static', filename='video/world_journey.mp4') }}" width="100%" autoplay muted></video>
    <div id="questionOverlay">
      <div class="character-container">
        <img src="{{ url_for('static', filename='images/character.png') }}" class="character">
        <div class="speech-bubble" id="questionText">Loading...</div>
      </div>
    </div>
    <div id="badge-container"></div>
    <div id="badge-tray"></div>
    <div id="trait-message">New personality trait gained!</div>
  </div>

  <audio id="clickSound" src="{{ url_for('static', filename='audio/click.mp3') }}"></audio>
  <audio id="ambienceMusic" src="{{ url_for('static', filename='audio/ambience.mp3') }}" loop autoplay></audio>

  <script>
    const timestamps = [
      0, 7, 12, 18, 23, 29, 35, 40, 45, 51, 57, 63, 68, 77, 82, 87,
      94, 99, 105, 111, 117, 122, 128, 133, 138, 145, 150, 154, 160,
      165, 171, 175, 183, 190, 195, 201, 207, 213, 218, 223, 229, 235
    ];

    const placeNames = [
      "Mount Fuji", "Zen Garden", "Shaolin Temple", "Luang Prabang", "Tawang", "Varanasi", "Auroville", "Borobudur", "Angkor Wat",
      "Leishan Buddha", "Terracotta Warrior", "Great Wall", "Himeji Castle", "Moai Statues", "Machu Picchu", "Chichen Itza",
      "Stonehenge", "Neuschwanstein Castle", "Acropolis", "Gobleki Tepe", "Petra", "Pyramids of Khufu", "Plitvice Lakes", "Aurora Observatory",
      "Lake Baikal", "Banff", "Niagara Falls", "Yellowstone", "Grand Canyon", "Amazon Rainforest", "Iguazu Waterfall", "Salar de Uyuni",
      "Galapagos", "Volcano Islands", "Uluru", "Great Barrier Reef", "Ha Long Bay", "Western Ghats", "Kilimanjaro", "Underwater Waterfall",
      "Antarctica", "South Pole"
    ];

    const questions = [
      "What makes you feel truly alive?",
      "Which of these aligns with your childhood dream?",
      "How do you define success?",
      "What kind of tasks drain you?",
      "Which type of work energizes you most?",
      "What kind of people do you enjoy helping?",
      "If money weren't a concern, what would you do every day?",
      "Which activities make you lose track of time?",
      "What problems in the world do you feel called to solve?",
      "What would you regret not doing in your lifetime?",
      "How do you react to competition?",
      "Do you prefer structure or spontaneity?",
      "Which describes your dream work environment?",
      "Do you value recognition or inner satisfaction more?",
      "Would you lead or collaborate in a group?",
      "What kind of legacy do you want to leave behind?",
      "Which best describes your role in a team?",
      "Are you more analytical or creative?",
      "Do you work better under pressure or with calm deadlines?",
      "How important is personal freedom to you?",
      "What do you fear losing the most?",
      "Are you more of a planner or a go-with-the-flow type?",
      "How do you resolve conflicts?",
      "Which natural element do you resonate with most?",
      "If you were an animal, which would you be?",
      "Which do you value more: stability or excitement?",
      "Would you prefer routine or novelty in work?",
      "Are you results-focused or process-enjoying?",
      "Which color appeals to you most today?",
      "Do you prefer exploring ideas or solving problems?",
      "Where would you build your dream home?",
      "What role does intuition play in your decisions?",
      "How do you handle criticism?",
      "What drives you more: purpose or pleasure?",
      "Do you enjoy guiding others or being guided?",
      "Would you rather write a book or build a product?",
      "Which quote resonates most with you?",
      "How would friends describe your energy?",
      "What's your ultimate life goal?"
    ];

    let currentQuestion = 0;
    const video = document.getElementById('quizVideo');
    const questionText = document.getElementById('questionText');
    const clickSound = document.getElementById('clickSound');

    video.addEventListener('timeupdate', () => {
      const currentTime = Math.floor(video.currentTime);
      if (currentQuestion < timestamps.length && currentTime >= timestamps[currentQuestion]) {
        video.pause();
        questionText.textContent = `Where are we? ${placeNames[currentQuestion]}\nQ${currentQuestion + 1}: ` + questions[currentQuestion];
        // Trigger question logic
        clickSound.play();
      }
    });

    function answerQuestion() {
      // Handle answer logic...
      showBadge();
      currentQuestion++;
      if (currentQuestion < timestamps.length) video.play();
      else showResults();
    }

    function showBadge() {
      if ((currentQuestion + 1) % 3 === 0) {
        const badge = document.createElement("div");
        badge.classList.add("badge-instance");
        const anim = lottie.loadAnimation({
          container: badge,
          renderer: 'svg',
          loop: false,
          autoplay: true,
          path: `/static/badges/${(currentQuestion + 1) / 3}.json`
        });

        document.getElementById("badge-container").appendChild(badge);

        setTimeout(() => {
          badge.remove();
          const trayBadge = document.createElement("div");
          trayBadge.classList.add("tray-badge");
          trayBadge.innerText = `Trait ${(currentQuestion + 1) / 3}`; // Replace with image or lottie if desired
          document.getElementById("badge-tray").appendChild(trayBadge);
          showTraitMessage();
        }, 1800);
      }
    }

    function showTraitMessage() {
      const msg = document.getElementById("trait-message");
      msg.style.opacity = 1;
      setTimeout(() => msg.style.opacity = 0, 2000);
    }

    function showResults() {
      alert("All traits collected! Click to see results.");
      // Redirect or open results popup
    }
  </script>

  <style>
    #video-container {
      position: relative;
    }
    .character {
      width: 200px;
    }
    .speech-bubble {
      font-size: 1.5rem;
      max-width: 600px;
      background: #fff;
      padding: 18px;
      border-radius: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    #questionOverlay {
      position: absolute;
      bottom: 20px;
      left: 20px;
    }
    #badge-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
    }
    .badge-instance {
      width: 100px;
      height: 100px;
      animation: flyBadge 1.5s ease-out forwards;
    }
    @keyframes flyBadge {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: translate(500px, -250px) scale(0.5); opacity: 0; }
    }
    #badge-tray {
      position: absolute;
      top: 10px;
      right: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .tray-badge {
      background: gold;
      padding: 5px 10px;
      border-radius: 12px;
      font-size: 0.9rem;
      box-shadow: 0 1px 5px rgba(0,0,0,0.3);
    }
    #trait-message {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.9);
      padding: 20px;
      font-size: 1.5rem;
      color: #333;
      border-radius: 20px;
      opacity: 0;
      transition: opacity 0.5s;
      pointer-events: none;
    }
  </style>
</body>
</html>
