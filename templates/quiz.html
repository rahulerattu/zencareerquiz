<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ZenCareer Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.9.6/lottie.min.js"></script>
</head>
<body>
  <div id="video-container">
    <video id="quizVideo" src="https://zencareer.b-cdn.net/world_journey.mp4" width="100%" autoplay muted></video>
    <div id="questionOverlay">
      <div class="character-container">
        <img src="{{ url_for('static', filename='images/character.png') }}" class="character">
        <div class="speech-bubble" id="questionText">Loading...</div>
      </div>
      <div id="answers"></div>
    </div>
    <div id="badge-container"></div>
    <div id="badge-tray"></div>
    <div id="trait-message">New personality trait gained!</div>
    <div id="final-screen">
      <h2>All Personality Traits Collected!</h2>
      <button onclick="window.location.href='/results'">Show Results</button>
    </div>
  </div>

  <audio id="clickSound" src="{{ url_for('static', filename='audio/click.mp3') }}"></audio>
  <audio id="ambienceMusic" src="{{ url_for('static', filename='audio/ambience.mp3') }}" loop autoplay></audio>

  <script>
    const timestamps = [
      0, 7, 12, 18, 23, 29, 35, 40, 45, 51, 57, 63, 68, 77, 82, 87,
      94, 99, 105, 111, 117, 122, 128, 133, 138, 145, 150, 154, 160,
      165, 171, 175, 183, 190, 195, 201, 207, 213, 218, 223
    ];

    const placeNames = [
      "Mount Fuji", "Zen Garden", "Shaolin Temple", "Luang Prabang", "Tawang", "Varanasi", "Auroville", "Borobudur", "Angkor Wat",
      "Leishan Buddha", "Terracotta Warrior", "Great Wall", "Himeji Castle", "Moai Statues", "Machu Picchu", "Chichen Itza",
      "Stonehenge", "Neuschwanstein Castle", "Acropolis", "Gobleki Tepe", "Petra", "Pyramids of Khufu", "Plitvice Lakes", "Aurora Observatory",
      "Lake Baikal", "Banff", "Niagara Falls", "Yellowstone", "Grand Canyon", "Amazon Rainforest", "Iguazu Waterfall", "Salar de Uyuni",
      "Galapagos", "Volcano Islands", "Uluru", "Great Barrier Reef", "Ha Long Bay", "Western Ghats", "Kilimanjaro", "Underwater Waterfall",
      "Antarctica"
    ];

    const questions = [
      "What brings you joy every day?", "Do you enjoy helping others?", "Are you more of a dreamer or a doer?",
      "How do you react under stress?", "Are you more spiritual or scientific?", "Do you like structured routines?",
      "What fuels your curiosity the most?", "Are you driven by passion or discipline?", "Do challenges excite or scare you?",
      "How important is tradition in your life?", "Do you prefer solitude or crowds?", "What defines inner peace for you?",
      "Do you value simplicity or luxury?", "What kind of legacy do you wish to leave?", "Are you more analytical or intuitive?",
      "Do you believe in fate or free will?", "Is creativity your strength?", "Do you seek comfort or adventure?",
      "Is harmony more important than victory?", "Do you think deeply before acting?", "Are you a natural leader?",
      "Do you connect more with people or nature?", "Are you highly self-aware?", "Do you prefer to plan or improvise?",
      "Does emotion guide your decisions?", "Do you adapt well to change?", "Do you prefer to teach or learn?",
      "What does success mean to you?", "Do you love the unknown?", "Are you self-disciplined?",
      "Do you avoid conflict or confront it?", "How do you recharge best?", "Do you enjoy long-term goals?",
      "Are you more logic-based or feeling-based?", "Do you have strong convictions?", "How often do you reflect inwardly?",
      "Are you patient or impulsive?", "Do you believe in lifelong learning?", "What drives you: fear or love?",
      "Do you embrace extremes?"
    ];

    const answersList = ["Strongly Agree", "Agree", "Neutral", "Disagree", "Strongly Disagree"];

    let currentQuestion = 0;
    const video = document.getElementById('quizVideo');
    const questionText = document.getElementById('questionText');
    const answersDiv = document.getElementById('answers');
    const clickSound = document.getElementById('clickSound');

    video.addEventListener('timeupdate', () => {
      if (currentQuestion < timestamps.length && video.currentTime >= timestamps[currentQuestion]) {
        video.pause();
        showQuestion();
      }
    });

    function showQuestion() {
      questionText.textContent = `(${placeNames[currentQuestion]})\nQ${currentQuestion + 1}: ` + questions[currentQuestion];
      answersDiv.innerHTML = "";
      answersList.forEach(ans => {
        const btn = document.createElement("button");
        btn.innerText = ans;
        btn.onclick = () => handleAnswer();
        answersDiv.appendChild(btn);
      });
    }

    function handleAnswer() {
      clickSound.play();
      showBadge(currentQuestion + 1);
      currentQuestion++;
      if (currentQuestion < timestamps.length) {
        video.play();
      } else {
        showFinalScreen();
      }
    }

    function showBadge(index) {
      const badge = document.createElement("div");
      badge.classList.add("badge-instance");
      lottie.loadAnimation({
        container: badge,
        renderer: 'svg',
        loop: false,
        autoplay: true,
        path: `/static/badges/${index}.json`
      });
      document.getElementById("badge-container").appendChild(badge);

      setTimeout(() => {
        badge.remove();
        const trayBadge = document.createElement("div");
        trayBadge.classList.add("tray-badge");
        trayBadge.innerText = `Trait ${index}`;
        document.getElementById("badge-tray").appendChild(trayBadge);
        showTraitMessage();
      }, 1800);
    }

    function showTraitMessage() {
      const msg = document.getElementById("trait-message");
      msg.style.opacity = 1;
      setTimeout(() => msg.style.opacity = 0, 2000);
    }

    function showFinalScreen() {
      video.pause();
      document.getElementById("final-screen").style.display = "block";
    }
  </script>
</body>
</html>
